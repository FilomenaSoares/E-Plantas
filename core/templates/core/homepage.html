{% extends 'core/base.html' %}
{% load static %}

{% block title %}E-Plantas | Sua casa mais verde{% endblock %}

{% block content %}

<!-- Seção do Carrossel de Destaques -->
<section class="w-full h-[60vh] bg-green-600 text-white relative group" 
         x-data="{ 
            activeSlide: 1, 
            totalSlides: {{ featured_items|length }},
            autoplayInterval: null,
            nextSlide() {
                this.activeSlide = this.activeSlide === this.totalSlides ? 1 : this.activeSlide + 1;
                this.resetAutoplay();
            },
            prevSlide() {
                this.activeSlide = this.activeSlide === 1 ? this.totalSlides : this.activeSlide - 1;
                this.resetAutoplay();
            },
            startAutoplay() {
                if (this.totalSlides <= 1) return;
                this.autoplayInterval = setInterval(() => {
                    this.activeSlide = this.activeSlide < this.totalSlides ? this.activeSlide + 1 : 1;
                }, 5000);
            },
            resetAutoplay() {
                clearInterval(this.autoplayInterval);
                this.startAutoplay();
            }
         }"
         x-init="startAutoplay()">
    
    {% if not featured_items %}
        <div class="absolute inset-0 flex items-center justify-center p-8 bg-cover bg-center"
             style="background-image: url('https://placehold.co/1920x1080/16A34A/FFFFFF?text=Bem-vindo+ao+E-Plantas')">
        </div>
    {% else %}
        <!-- Slides -->
        {% for item in featured_items %}
        <div x-show="activeSlide === {{ forloop.counter }}" 
             x-transition:enter="transition-opacity ease-in-out duration-700"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-in-out duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="absolute inset-0 flex items-center justify-center p-8 bg-cover bg-center">
            <div class="absolute inset-0 bg-center bg-cover" style="background-image: url('{% if item.image %}{{ item.image.url }}{% else %}{% if item.post_type == 'ARTIGO' %}https://placehold.co/1920x1080/059669/FFFFFF?text=Artigo+Científico{% elif item.post_type == 'DICA' %}https://placehold.co/1920x1080/10B981/FFFFFF?text=Dica+de+Cultivo{% endif %}{% endif %}')"></div>
            <div class="relative bg-black bg-opacity-50 p-8 rounded-lg text-center max-w-3xl">
                {% if item.post_type %}
                    <h1 class="text-4xl md:text-6xl font-bold mb-4">{{ item.title }}</h1>
                    <a href="{% url 'blog:post_detail' item.id %}" class="bg-white text-green-700 font-bold py-3 px-6 rounded-lg hover:bg-gray-200 transition duration-300">
                        {% if item.post_type == 'ARTIGO' %}Ler Artigo{% else %}Ver Dica{% endif %}
                    </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        <!-- Botões de Controle (Anterior/Próximo) -->
        <button @click="prevSlide()" class="absolute top-1/2 left-4 -translate-y-1/2 bg-white/30 text-white p-2 rounded-full hover:bg-white/50 transition opacity-0 group-hover:opacity-100">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        </button>
        <button @click="nextSlide()" class="absolute top-1/2 right-4 -translate-y-1/2 bg-white/30 text-white p-2 rounded-full hover:bg-white/50 transition opacity-0 group-hover:opacity-100">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </button>

        <!-- Indicadores de Posição -->
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">
            <template x-for="i in totalSlides">
                <button @click="activeSlide = i; resetAutoplay()" :class="{'bg-white': activeSlide === i, 'bg-white/50': activeSlide !== i}" class="w-3 h-3 rounded-full hover:bg-white transition"></button>
            </template>
        </div>
    {% endif %}
</section>

<!-- SEÇÃO: Últimas do Blog -->
<section class="py-16 bg-green-50">
    <div class="container mx-auto px-6">
        <h2 class="text-3xl font-bold text-center mb-10">Últimas do Nosso Blog</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {% for post in recent_posts %}
            <div class="bg-white rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-2 transition duration-300 flex flex-col">
                <a href="{% url 'blog:post_detail' post.id %}" class="block h-56 overflow-hidden">
                    <img src="{% if post.image %}{{ post.image.url }}{% else %}https://placehold.co/600x400/10B981/FFFFFF?text=E-Plantas{% endif %}" alt="[Imagem de {{ post.title }}]" class="w-full h-full object-cover">
                </a>
                <div class="p-6 flex flex-col flex-grow">
                    <div class="mb-4 flex-grow">
                        {% if post.post_type == 'ARTIGO' %}
                            <span class="text-xs font-semibold uppercase tracking-wider bg-blue-100 text-blue-800 py-1 px-2 rounded-full">Artigo</span>
                        {% else %}
                            <span class="text-xs font-semibold uppercase tracking-wider bg-yellow-100 text-yellow-800 py-1 px-2 rounded-full">Dica</span>
                        {% endif %}
                        <h3 class="text-xl font-semibold my-2">{{ post.title }}</h3>
                        <p class="text-gray-600 text-sm">{{ post.content|truncatewords:20 }}</p>
                    </div>
                    <a href="{% url 'blog:post_detail' post.id %}" class="font-semibold text-green-600 hover:text-green-800 self-start">Ler mais &rarr;</a>
                </div>
            </div>
            {% empty %}
            <p class="col-span-full text-center text-gray-500">Nenhuma postagem no blog ainda.</p>
            {% endfor %}
        </div>
    </div>
</section>

{% endblock %}
